


let listeLevel = [[ ['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','R','P','R','T','T','T','T','T','T','T','V','T','T','T','T','T','R','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','V','V','V','V','V','D','R','R','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','R','R','R','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','R','D','R','T','T','T','R','D','R','V','T','T','T','T','T','T','T','T','M']
,['M','M','M','M','M','M','M','M','T','T','T','T','T','R','R','R','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','M','T','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','D','M','T','T','T','T','T','T','T','T','R','D','R','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','M','T','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']],

 [[ 'M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','R','P','R','T','T','T','T','T','T','T','V','T','T','T','T','T','R','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','V','V','V','V','V','M','R','R','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','V','T','T','T','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','D','T','T','T','R','R','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','R','R','R','T','T','T','T','T','T','D','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','R','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','V','D','R','T','T','T','T','T','T','T','T','T','T','T','T','T','T','V','R','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','D','D','D','T','T','T','T','T','T','T','T','T','T','T','T','T','T','V','R','T','T','T','T','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']],

[[ 'M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']
,['M','T','T','T','T','T','T','T','T','M','T','T','R','V','T','T','T','T','T','T','T','T','D','M','T','T','T','T','T','T','T','M']
,['M','T','R','P','R','T','T','T','T','M','T','T','M','V','M','M','M','M','M','M','M','M','M','M','T','T','T','T','T','T','T','M']
,['M','T','D','T','T','T','T','T','T','M','T','T','M','V','V','V','V','V','V','R','R','V','V','T','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','M','T','T','M','V','M','M','M','M','M','V','M','M','V','M','T','T','T','T','T','T','T','M']
,['M','T','T','T','T','T','T','T','T','T','R','V','M','D','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','T','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','T','M','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','T','M','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','T','R','D','M','T','T','M']
,['M','T','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','R','M','D','R','T','M']
,['M','T','T','T','T','T','T','T','T','T','T','T','T','T','M','R','D','T','T','T','T','T','T','T','T','M','R','D','D','R','T','M']
,['M','R','M','M','M','M','M','M','M','M','M','M','M','M','M','V','R','D','T','T','T','T','T','T','T','M','R','D','D','R','T','M']
,['M','R','T','T','T','T','T','T','V','R','T','T','T','T','D','V','R','T','T','T','T','T','T','T','T','V','R','D','D','R','T','M']
,['M','D','T','T','T','T','T','M','V','M','M','M','M','M','M','V','R','T','T','T','T','T','T','T','T','D','R','D','V','R','T','M']
,['M','D','T','T','T','T','T','T','T','T','T','T','T','D','M','V','R','T','T','T','T','T','T','T','T','D','D','V','V','R','D','M']
,['M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M','M']]];

//création de la liste de niveau de base
let gestionHTML = document.querySelector("gestion"); //récupération de l'élement HTML Gestion
let tabButSup = []; //initialisation du tableau de bouton sup
let tabButDown = []; // initialisation du tableau de bouton down
let tabButUp = [];//initialisation du tableau de bouton up
window.onload = verif();
window.onload = affichage();//appel des fonctions au lancement de la page
window.onload = del();
window.onload = changeOrder();

function affichage(){ //fonction permettant l'affichage des différents élements de la page
    let nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
    gestionHTML.innerHTML  = "";//Vide l'affichage actuel
    tabButSup = []; //Remise des tableaux à zero
    tabButDown = [];
    tabButUp = [];
    for(let i = 1; i < nbrLevel+1 ; i++) // Pour chaque niveau 
    {
        let divUpAndDown = document.createElement("div"); //création d'une div up and down pour chaque niveau facilitant le CSS
        divUpAndDown.className = "UpAndDown";// avec cette class
        let ligneHTML = document.createElement("div");// création d'une div qui servira de ligne où on placera les élements de gestion d'un niveau
        ligneHTML.id = i-1; // on place un id
        for(let j = 0 ; j < 4; j++)
        {
            if(j == 0)
            {
                var niveau = document.createElement("div"); // En premier on crée la div où on place le nom du niveau
                niveau.innerHTML = "NIVEAU "+ i; // on rentre le texte niveau puis le niveau qu'il s'agit
                ligneHTML.appendChild(niveau); //Insertion de la div niveau dans la ligne HTML
                niveau.className = "niv";//on place une class niveau
            }
            if(j == 1)
            {
                var supp = document.createElement("button"); //création d'un bouton pour la suppression
                supp.innerHTML = ""// sans texte
                supp.className="del";//avec la classe del

                supp.id = i-1;//et un id
                ligneHTML.appendChild(supp)//Insertion dans la ligne
            }
            if(j == 2 )
            {
                if((i == nbrLevel) && j ==2 )
                {
                    var down = document.createElement("div");//création d'une pour descendre
                    down.id = i-1; // avec cet id
                    down.className= "downVoid"; //et un classname void pour ne pas qu'elle apparaisse
                    divUpAndDown.appendChild(down); // Insertion de la div down dans la div up and down
                }
                else
                {
                    var down = document.createElement("button");//création d'un bouton pour le changement d'ordre 
                    down.innerHTML = "";//sans texte
                    down.className= "down";//avec le nom de classe down
                    down.id = i-1;
                    divUpAndDown.appendChild(down); //on insère dans la div   
                }
            }
            if(j == 3)
            {
                if(i == 1 && j == 3)
                {
                    var up = document.createElement("div"); // création d'une  div up
                    up.id = i-1;
                }
                else
                {
                    var up = document.createElement("button"); // création d'un bouton up pour le changement d'ordre
                    up.innerHTML = ""; //sans texte
                    up.className = "up" // avec le nom de classe up
                    up.id = i-1;
                    divUpAndDown.appendChild(up); // Insertion dans la div up and down     
                } 
            }
            ligneHTML.appendChild(divUpAndDown) // Insertion finale dans la ligneHTML
        }  
        gestionHTML.appendChild(ligneHTML); //on insère toute les lignes dans la gestion
        tabButSup.push(supp); // on remplit le tableau de bouton supp
        tabButDown.push(down);// on remplit le tableau de bouton down
        tabButUp.push(up);// on remplit le tableau de bouton up
    }
    return tabButSup; // fonction retournant le tableau de boutons supp
}

function del(){ //fontion pour supprimer un niveau
    
    tabButSup.forEach(button => { // pour chaque bouton dans le tableau
        button.addEventListener("click",() => { //à l'évenement click
            let nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
            let listeLevelTemp = JSON.parse( localStorage.getItem("listeLevel")); // récupération de la liste de niveaux en mémoire dans le local storage
            let compte = button.id; // Récupération du niveau que l'on souhaite supprimer avec l'id du bouton
            if(confirm("Voulez vous supprimer le niveau?")) // demande de confirmation avant la suppression
            {
                if(nbrLevel != 1 ) // Condition : si il y a plus de un niveau en mémoire
                {
                    listeLevelTemp.splice(compte, 1); //suppression du niveau
                    localStorage.setItem("listeLevel" , JSON.stringify( listeLevelTemp)); // on enregistre la nouvelle liste de tableau dans le local storage
                    nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
                    tabButSup = affichage(); //mise a jour du tableau de bouton de suppression
                    localStorage.setItem("Save", null); //on enregistre à null le local storage à la clé Save pour ne pas avoir de problème avec la reprise de niveaux
                    del(); //appel des fonctions
                    changeOrder();        
                }    
                else // condition : si il n'y a qu'un niveau en mémoire
                {
                    localStorage.setItem("listeLevel", JSON.stringify(listeLevel)); // on remet tous les niveaux de base
                    nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
                    listeLevelTemp = listeLevel.slice(0,nbrLevel); //copie des niveaux de base 
                    tabButSup = affichage();//appel des fonctions
                    localStorage.setItem("Save", null);//on enregistre à null le local storage à la clé Save pour ne pas avoir de probleme avec la reprise de niveaux
                    del();//appel des fonctions
                    changeOrder();
                }    
            }
        });
    });
}

function changeOrder()//fonction pour changer l'ordre des niveaux (problèmes de changement de noms)
{  
    tabButDown.forEach(button => { //pour chaque bouton pour descendre
        button.addEventListener("click", () => {// quand on clique..
            let nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
            let listeLevelTemp = JSON.parse( localStorage.getItem("listeLevel"))//Enregistrement des niveaux en mémoires
            let compte = parseInt(button.id); //Récupération du niveau sur lequel on a cliqué avec l'id du boutton
            if(nbrLevel == 1){}//si un seul niveau on ne fait rien
            else if (compte == nbrLevel -1){}//si c'est le dernier niveau on fait rien
            else //sinon ..
            {
                let listeLevelMem = listeLevelTemp.slice(0,listeLevelTemp.length)// copie des niveaux en mémoire
                listeLevelTemp[compte] = listeLevelMem[compte + 1];//Changement de l'ordre
                listeLevelTemp[compte + 1] = listeLevelMem[compte];
                localStorage.setItem("listeLevel", JSON.stringify(listeLevelTemp));//enregistrement du tableau dans la mémoire
                localStorage.setItem("Save", null); //mise à null de la clef Save dans la mémoire pour réinitialiser la reprise
                tabButSup =  affichage();//appel des fonctions
                changeOrder();
                del();
            }
        })
    });

    tabButUp.forEach(button => { //pour chaque bouton "up"
        button.addEventListener("click", () => { //on clique ...
            let nbrLevel = JSON.parse( localStorage.getItem("listeLevel")).length //récupération du nombre de niveaux
            let listeLevelTemp = JSON.parse( localStorage.getItem("listeLevel")) // récupération des niveaux en mémoires
            let compte = parseInt(button.id) //récupération du niveau par l'id
            if(nbrLevel == 1){} // si un seul niveau, aucune action effectuée
            else if(compte == 0){}//si c'est le premier niveau alors pas de bouton "up"
            else//sinon..
            {
                let listeLevelMem = listeLevelTemp.slice(0,listeLevelTemp.length)//copie de la liste de niveau en mémoire
                listeLevelTemp[compte] = listeLevelMem[compte - 1];//échange des niveaux
                listeLevelTemp[compte - 1] = listeLevelMem[compte];                
                localStorage.setItem("listeLevel", JSON.stringify(listeLevelTemp));
                localStorage.setItem("Save", null);//mise à null du niveau sauvegadé
                tabButSup =  affichage(); //affichage
                changeOrder();//appel des fonctions de gestion
                del();
            }
        })
    })
}

function addLevel() //fonction d'ajout de niveau
{
    const adder = document.getElementById("monNiveau");//récupère l'élèment d'ajout de niveaux
    adder.addEventListener('change', function() { //quand un changement est détecté..
         var fr = new FileReader();//création d'un lecteur de fichier avec le constructeur FileReader
        fr.onload = function() // au chargement appel de la fonction qui ..
        {
            var output = document.getElementById("output"); //récupère la div output
            output.textContent = fr.result;//lui insère le contenu du fichier
            var contenu = output.innerHTML; //récupération du contenu du fichier
            let TabBonFormat = []; // initialisation d'un tableau vide
            let lignes = contenu.split("\n");//séparation des lignes 

            lignes.forEach(ligne => { //pour chaque ligne
                let ligneAtraiter = ligne.split(""); //sépare chaque élément par des guillements
                if(ligneAtraiter[ligneAtraiter.length - 1] == "\r") //si la ligne se termine par un "\r"
                {
                    ligneAtraiter.pop(); //on le supprime
                    TabBonFormat.push(ligneAtraiter);//puis on l'insère dans le tableau
                }
                else{
                    TabBonFormat.push(ligneAtraiter);
                }  
            }) 
        let tabEnMem = JSON.parse( localStorage.getItem("listeLevel"))//récupération des tableaux en mémoires
        tabEnMem.push(TabBonFormat);//lui ajoute le nouveau niveau
        localStorage.setItem("listeLevel" , JSON.stringify(tabEnMem));//enregistre la nouvelle liste dans le local storage
        localStorage.setItem("Save", null);//vide le niveau sauvegardé
        affichage();//appel les fonctions de gestion
        output.innerHTML = "";//vide le contenu de la div output
        del();
        changeOrder();
        }
        fr.readAsText(this.files[0]);
    })  
        
}

addLevel();//appel la fonction

function verif() //fonction vérifiant si des niveaux sont en mémoires 
{
    if(localStorage.getItem("listeLevel") == null) //si aucun niveau en mémoire..
    {
        localStorage.setItem("listeLevel" , JSON.stringify(listeLevel));//place les niveaux de base
        affichage();
    }
}








